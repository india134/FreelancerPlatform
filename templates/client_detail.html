{# templates/client_detail.html #}
{% extends "base.html" %}

{% block title %}Projects ‚Äì {{ client.name }}{% endblock %}

{% block content %}
<div class="container my-5">

  <!-- Back Button + Client Info -->
  <a href="{{ url_for('dashboard') }}" class="btn btn-outline-primary mb-4">
    ‚Üê Back to Dashboard
  </a>
  <div class="card mb-4 shadow-sm">
    <div class="card-body">
      <h2 class="card-title">{{ client.name }}</h2>
      <p class="card-text mb-0">
        <strong>Email:</strong> {{ client.email }}
        <strong class="ms-3">Phone:</strong> {{ client.phone or '‚Äî' }}
      </p>
      {% if client.notes %}
        <p class="mt-2"><em>{{ client.notes }}</em></p>
      {% else %}
        <p class="mt-2 text-muted"><em>No notes for this client.</em></p>
      {% endif %}
    </div>
  </div>

  <!-- Projects Section -->
  <div class="card shadow-sm">
    <div class="card-header d-flex justify-content-between align-items-center">
      <h4 class="mb-0">Projects</h4>
      <a href="{{ url_for('add_project', client_id=client.id) }}"
         class="btn btn-primary btn-sm">
        + Add Project
      </a>
    </div>
    <div class="card-body p-0">
      {% if projects %}
        <table class="table table-striped mb-0">
          <thead class="table-light">
            <tr>
              <th style="width:5%;">#</th>
              <th>Title</th>
              <th>Start</th>
              <th>End</th>
              <th style="width:15%;">Actions</th>
            </tr>
          </thead>
          <tbody>
            {% for p in projects %}
              <tr>
                <td>{{ loop.index }}</td>
                <td>{{ p.title }}</td>
                <td>
                  {{ p.start_date.strftime('%Y-%m-%d') 
                     if p.start_date else '‚Äî' }}
                </td>
                <td>
                  {{ p.end_date.strftime('%Y-%m-%d') 
                     if p.end_date else '‚Äî' }}
                </td>
                <td>
  <!-- View button -->
  <a href="{{ url_for('client_project_detail', client_id=p.client_id, project_id=p.id) }}"
     class="btn btn-outline-secondary btn-sm me-2">
    View
  </a>

  <!-- Delete button (POST + CSRF) -->
  <form
    method="POST"
    action="{{ url_for('delete_project', client_id=client.id, project_id=p.id) }}"
    class="d-inline me-2"
    onsubmit="return confirm('Delete project ‚Äú{{ p.title }}‚Äù?');"
  >
    {{ csrf_form.hidden_tag() }}
    <button type="submit" class="btn btn-outline-danger btn-sm">
      üóë
    </button>
  </form>

  <!-- EDIT button, now right next to the delete -->
  <a
    href="{{ url_for('edit_project', project_id=p.id) }}"
    class="btn btn-outline-primary btn-sm"
  >
    Edit
  </a>
</td>
              </tr>
            {% endfor %}
          </tbody>
        </table>
      {% else %}
        <div class="p-4 text-center text-muted">
          No projects yet for this client.
        </div>
      {% endif %}
    </div>
  </div>

</div>
{% endblock %}
